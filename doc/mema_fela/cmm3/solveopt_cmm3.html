<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of solveopt_cmm3</title>
  <meta name="keywords" content="solveopt_cmm3">
  <meta name="description" content="solveopt_cmm: Created the conic constraint matrices.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # mema_fela --><!-- menu.html cmm3 -->
<h1>solveopt_cmm3
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>solveopt_cmm: Created the conic constraint matrices.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [sol]=solveopt_cmm3(nel,Hsup,Rsup,Ab,blc,buc,bs,bt,subi,G,options) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> solveopt_cmm: Created the conic constraint matrices.
  FORMAT: [x, y]=solveopt_cmm(nel,Hsup,Rsup,Ab,blc,buc,C)


 Input:
  nel: Number of elements
  Hsup: Global equilibrium matrix excluding supports
  Rsup: As the above, but excluding supported dofs
  Ab: Constrint matrix
  blc: Lower yield criteria
  buc: Upper yield criteria


 Optional input:
  options: struct: Structure which contains different options to be used
  througout the program.


 Output:
  sol: struct: structure containing the solution with fields:
   xt: Total stresses in each stresspoint
   xs: Stresses in steel (for RC shows steek part if concrete
   xc: concrete stresses (without smeared reinforcement)
   y : collapse mode
   lambda: load-factor

 13-03-2018 Mads Emil Møller Andersen &amp; Nikolaj Skafte Koch

 Latest author:
 30-07-2019 Mads Emil Møller Andersen - MEMAndersen@gmail.com</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../mema_fela/fela/fela_main.html" class="code" title="function [sol, prob]= fela_main(msh_path, materials, supports, loads, varargin)">fela_main</a>	fela_main: Main runner of the FELA-program</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [sol]=solveopt_cmm3(nel,Hsup,Rsup,Ab,blc,buc,bs,bt,subi,G,options)</a>
0002 <span class="comment">% solveopt_cmm: Created the conic constraint matrices.</span>
0003 <span class="comment">%  FORMAT: [x, y]=solveopt_cmm(nel,Hsup,Rsup,Ab,blc,buc,C)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Input:</span>
0007 <span class="comment">%  nel: Number of elements</span>
0008 <span class="comment">%  Hsup: Global equilibrium matrix excluding supports</span>
0009 <span class="comment">%  Rsup: As the above, but excluding supported dofs</span>
0010 <span class="comment">%  Ab: Constrint matrix</span>
0011 <span class="comment">%  blc: Lower yield criteria</span>
0012 <span class="comment">%  buc: Upper yield criteria</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Optional input:</span>
0016 <span class="comment">%  options: struct: Structure which contains different options to be used</span>
0017 <span class="comment">%  througout the program.</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Output:</span>
0021 <span class="comment">%  sol: struct: structure containing the solution with fields:</span>
0022 <span class="comment">%   xt: Total stresses in each stresspoint</span>
0023 <span class="comment">%   xs: Stresses in steel (for RC shows steek part if concrete</span>
0024 <span class="comment">%   xc: concrete stresses (without smeared reinforcement)</span>
0025 <span class="comment">%   y : collapse mode</span>
0026 <span class="comment">%   lambda: load-factor</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% 13-03-2018 Mads Emil Møller Andersen &amp; Nikolaj Skafte Koch</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% Latest author:</span>
0031 <span class="comment">% 30-07-2019 Mads Emil Møller Andersen - MEMAndersen@gmail.com</span>
0032 
0033 <span class="comment">% unpack optional parameters</span>
0034 save_file = options.solver.save_file;
0035 save_name = options.solver.save_name;
0036 mosek_log = options.solver.mosek_log;
0037 mosek_echo = options.solver.mosek_echo;
0038 smeared_comp_factor = options.solver.smeared_comp_factor;
0039 
0040 <span class="comment">% Count members of each material</span>
0041 ind.RC = ismember(cellstr(G.type),<span class="string">'RC'</span>);
0042 ind.S = ismember(cellstr(G.type),<span class="string">'S'</span>);
0043 n.RC = sum(ind.RC);
0044 n.S = sum(ind.S);
0045 
0046 gA = G.A(:,ind.RC);
0047 
0048 <span class="comment">% Indices for materials</span>
0049 AllIndex = reshape(1:6*nel,6,nel);
0050 xRC_Index = AllIndex(:,ind.RC);
0051 xS_Index = AllIndex(:,ind.S);
0052 allS_index = repmat(1:3,nel,1)'+repmat(0:6:nel*6-6,3,1);
0053 S_index = allS_index(:,ind.RC);
0054 
0055 <span class="comment">% Total number of aux. vars</span>
0056 nax = n.RC*4+n.S*7;
0057 
0058 <span class="comment">% Equations and inequalities</span>
0059 O=sparse(size(Hsup,1),nax);
0060 
0061 A=[Hsup -Rsup  O
0062     Ab    ];
0063 prob.a = sparse(A);
0064 
0065 <span class="comment">% Limits for the equations:</span>
0066 O=sparse(size(Hsup,1),1);
0067 prob.blc = [O
0068     blc];
0069 prob.buc = [O
0070     buc];
0071 
0072 <span class="comment">% Limits for the variables:</span>
0073 
0074 prob.blx = [-bt, 0    -bs*smeared_comp_factor, -inf*ones(1,n.RC*1+n.S*7)]';
0075 prob.bux = [bt,  inf   bs,                      inf*ones(1,n.RC*1+n.S*7)]';
0076 
0077 
0078 <span class="comment">% Object function:</span>
0079 prob.c = [zeros(1,6*nel) 1 zeros(1,nax)];
0080 
0081 <span class="comment">% Semidefinite vars</span>
0082 <span class="keyword">if</span> n.RC &gt; 0
0083     prob.bardim = ones(1,3*n.RC)*3;
0084     prob.bara.subi = size(Hsup,1)+subi; <span class="comment">% Indices of semidefinte constraints</span>
0085     prob.bara.subj = reshape(ones(6,1).*(1:(3*n.RC)),1,6*3*n.RC); <span class="comment">% Semidefinite matrices</span>
0086     prob.bara.subk = repmat([1 2 3 2 3 3,<span class="keyword">...</span>
0087         1 2 3 2 3 3,<span class="keyword">...</span>
0088         1 2 3 2 3 3],1,n.RC);
0089     prob.bara.subl = repmat([1 2 3 1 1 2,<span class="keyword">...</span>
0090         1 2 3 1 1 2,<span class="keyword">...</span>
0091         1 2 3 1 1 2],1,n.RC);
0092     prob.bara.val = repmat([1 1 1 0.5 0.5 0.5,<span class="keyword">...</span>
0093         1 1 1 0.5 0.5 0.5,<span class="keyword">...</span>
0094         1 1 1 0.5 0.5 0.5],1,n.RC);
0095 <span class="keyword">end</span>
0096 
0097 <span class="comment">% Cones</span>
0098 <span class="keyword">if</span> n.S &gt; 0
0099     [~, res] = mosekopt(<span class="string">'symbcon'</span>);
0100     prob.cones.type = ones(1,n.S)*res.symbcon.MSK_CT_QUAD;
0101     prob.cones.sub = (1:(7*n.S)) + nel*6+1+4*n.RC;
0102     prob.cones.subptr = 1:7:7*n.S;
0103 <span class="keyword">end</span>
0104 
0105 <span class="comment">% Optimize the problem</span>
0106 <span class="comment">% Toogle data</span>
0107 param = <span class="string">''</span>;
0108 <span class="comment">%param.MSK_IPAR_NUM_THREADS = 4;</span>
0109 <span class="comment">% Save problem file</span>
0110 <span class="keyword">if</span> save_file
0111     cmd = sprintf(<span class="string">'write(%s)'</span>,save_name);
0112     mosekopt(cmd,prob)
0113 <span class="keyword">end</span>
0114 <span class="comment">% Run problem</span>
0115 <span class="keyword">if</span> mosek_log
0116     cmd = sprintf(<span class="string">'maximize log(%s_MosekLog.txt) echo(%d)'</span>,<span class="keyword">...</span>
0117         datestr(now,<span class="string">'yyyy-mm-dd-HH-MM-SS'</span>),mosek_echo);
0118 <span class="keyword">else</span>
0119     cmd = sprintf(<span class="string">'maximize echo(%d)'</span>, mosek_echo);
0120 <span class="keyword">end</span>
0121 
0122 [r, res]= mosekopt(cmd, prob,param);
0123 
0124 <span class="comment">% Extract solution</span>
0125 sol.xt = res.sol.itr.xx(1:(6*nel));
0126 sol.xs = zeros(nel*6,1);
0127 sol.xs(S_index(:)) = res.sol.itr.xx((6*nel+2):(end-(n.RC+7*n.S)));
0128 sol.xc = sol.xt; sol.xc(xS_Index) = 0;
0129 sol.xc(S_index(:)) = sol.xc(S_index(:))-sol.xs(S_index(:)).*gA(:);
0130 sol.y = res.sol.itr.y(1:size(Hsup,1));
0131 sol.lambda = res.sol.itr.xx((6*nel+1));</pre></div>
<hr><address>Generated on Wed 31-Jul-2019 14:03:20 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>