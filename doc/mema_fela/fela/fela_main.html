<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of fela_main</title>
  <meta name="keywords" content="fela_main">
  <meta name="description" content="fela_main: Main runner of the FELA-program">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # mema_fela --><!-- menu.html fela -->
<h1>fela_main
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>fela_main: Main runner of the FELA-program</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [sol, prob]= fela_main(msh_path, materials, supports, loads, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> fela_main: Main runner of the FELA-program
  FORMAT: res = fela_main(msh_path, material, supports, loads, varargin)

 Input:
  msh_path: string: Path to mesh file, by default this is expected to be a
   .msh file v. 4.1 created in GMSH 

  materials: struct: struct with the following build:
   materials.(material_name).type = (str), where str is either:
   'S' = steel or
   'RC' = reinforced concrete.
   material_name is the name used to refer to this material and can be
   choosen freely.
   materials.(material_name).physical_names = (cell) contains the
   physical names from the mesh which this material applies to.
   Depending on whether material is steel or reinforced concrete the 
   struct will also have fields:
   S:  fY = yield strength [MPa]
   RC: fc = concrete compressive strength [MPa];
       ft = concrete tensile strength [MPa];
       k  = k - parameter in Mohr_Coulomb k*s1 - s3 = fc (default k=4)
       a = [Ax, Ay, Az] = reinforcement deegree in x, y or z-direction as 
        the ratio [mm^2 reinforcement / mm^2 concrete]
       fY = [fYx, fYy, fYz] = reinforcement yield strength [MPa]

  supports: struct: struct with the following build:
   supports.(physical_name) = (int), where int is either 1=x, 2=y, 3=z

  loads: struct: struct with the follwing build:
   loads.(type).(physical_name) = [fx, fy, fz], where fx, fy and fz are
   load in each principal direction.
   (type) is which type of load is defined which can be either point,
   line, surface or volume.


 Optional input:
  options: struct: Structure which contains different options to be used
  througout the program.


 Output:
  sol: struct: structure containing the solution with fields:
   xt: Total stresses in each stresspoint
   xs: Stresses in steel (for RC shows steek part if concrete
   xc: concrete stresses (without smeared reinforcement)
   y : collapse mode
   lambda: load-factor
  prob: struct: problem input matrices
   X: node coordinats matrix
   T: element topology matrix
   G: material parameters struct
   S: supports matrix
   L: load matrix

 Latest author:
 30-07-2019 Mads Emil Møller Andersen - MEMAndersen@gmail.com</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../mema_fela/cmm3/setcon_cmm3.html" class="code" title="function [Ab,blc,buc,bs,bt,subi] = setcon_cmm3(nel,G,varargin)">setcon_cmm3</a>	rewriteL: Assembels the contraint matrix</li><li><a href="../../mema_fela/cmm3/seth_cmm3.html" class="code" title="function H=seth_cmm3(X,T,nel,neq,nvar,eqperel,varperel)">seth_cmm3</a>	seth_cmm: Assembles the global equilibrium matrix</li><li><a href="../../mema_fela/cmm3/setload_cmm3.html" class="code" title="function [R, Rsup]=setload_cmm3(neq,supeq,L)">setload_cmm3</a>	setload_cmm: Creates the RHS of equilibrium constraint</li><li><a href="../../mema_fela/cmm3/setsup_cmm3.html" class="code" title="function [supeq, H]=setsup_cmm3(S,H)">setsup_cmm3</a>	setsup_cmm: Excludes the supported dofs from the eq. matrix</li><li><a href="../../mema_fela/cmm3/setvareq_cmm3.html" class="code" title="function [nno,nel,nvar,neq,varperel,eqperel,legno]=setvareq_cmm3(X,T)">setvareq_cmm3</a>	setvareq_cmm: Sets variable equations and determines varous geometric</li><li><a href="../../mema_fela/cmm3/solveopt_cmm3.html" class="code" title="function [sol]=solveopt_cmm3(nel,Hsup,Rsup,Ab,blc,buc,bs,bt,subi,G,options)">solveopt_cmm3</a>	solveopt_cmm: Created the conic constraint matrices.</li><li><a href="fela_load.html" class="code" title="function L = fela_load(mesh, X, loads)">fela_load</a>	Preallocate temp_L</li><li><a href="fela_material.html" class="code" title="function G = fela_material(mesh, materials)">fela_material</a>	fela_material: Create material struct for program</li><li><a href="fela_options.html" class="code" title="function options = fela_options()">fela_options</a>	options for main script</li><li><a href="fela_support.html" class="code" title="function S = fela_support(mesh, supports)">fela_support</a>	fela_support: Create supports matrix</li><li><a href="../../mema_fela/gen_functions/fix_mesh.html" class="code" title="function mesh = fix_mesh(mesh)">fix_mesh</a>	</li><li><a href="../../mema_fela/gen_functions/load_msh.html" class="code" title="function mesh = load_msh(filename)">load_msh</a>	Open file and get lines</li><li><a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>	write_log: Logging in cmw and to file</li><li><a href="../../mema_fela/io/load_msh.html" class="code" title="function mesh = load_msh(filename)">load_msh</a>	Open file and get lines</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [sol, prob]= fela_main(msh_path, materials, supports, loads, varargin)</a>
0002 <span class="comment">% fela_main: Main runner of the FELA-program</span>
0003 <span class="comment">%  FORMAT: res = fela_main(msh_path, material, supports, loads, varargin)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Input:</span>
0006 <span class="comment">%  msh_path: string: Path to mesh file, by default this is expected to be a</span>
0007 <span class="comment">%   .msh file v. 4.1 created in GMSH</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%  materials: struct: struct with the following build:</span>
0010 <span class="comment">%   materials.(material_name).type = (str), where str is either:</span>
0011 <span class="comment">%   'S' = steel or</span>
0012 <span class="comment">%   'RC' = reinforced concrete.</span>
0013 <span class="comment">%   material_name is the name used to refer to this material and can be</span>
0014 <span class="comment">%   choosen freely.</span>
0015 <span class="comment">%   materials.(material_name).physical_names = (cell) contains the</span>
0016 <span class="comment">%   physical names from the mesh which this material applies to.</span>
0017 <span class="comment">%   Depending on whether material is steel or reinforced concrete the</span>
0018 <span class="comment">%   struct will also have fields:</span>
0019 <span class="comment">%   S:  fY = yield strength [MPa]</span>
0020 <span class="comment">%   RC: fc = concrete compressive strength [MPa];</span>
0021 <span class="comment">%       ft = concrete tensile strength [MPa];</span>
0022 <span class="comment">%       k  = k - parameter in Mohr_Coulomb k*s1 - s3 = fc (default k=4)</span>
0023 <span class="comment">%       a = [Ax, Ay, Az] = reinforcement deegree in x, y or z-direction as</span>
0024 <span class="comment">%        the ratio [mm^2 reinforcement / mm^2 concrete]</span>
0025 <span class="comment">%       fY = [fYx, fYy, fYz] = reinforcement yield strength [MPa]</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%  supports: struct: struct with the following build:</span>
0028 <span class="comment">%   supports.(physical_name) = (int), where int is either 1=x, 2=y, 3=z</span>
0029 <span class="comment">%</span>
0030 <span class="comment">%  loads: struct: struct with the follwing build:</span>
0031 <span class="comment">%   loads.(type).(physical_name) = [fx, fy, fz], where fx, fy and fz are</span>
0032 <span class="comment">%   load in each principal direction.</span>
0033 <span class="comment">%   (type) is which type of load is defined which can be either point,</span>
0034 <span class="comment">%   line, surface or volume.</span>
0035 <span class="comment">%</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% Optional input:</span>
0038 <span class="comment">%  options: struct: Structure which contains different options to be used</span>
0039 <span class="comment">%  througout the program.</span>
0040 <span class="comment">%</span>
0041 <span class="comment">%</span>
0042 <span class="comment">% Output:</span>
0043 <span class="comment">%  sol: struct: structure containing the solution with fields:</span>
0044 <span class="comment">%   xt: Total stresses in each stresspoint</span>
0045 <span class="comment">%   xs: Stresses in steel (for RC shows steek part if concrete</span>
0046 <span class="comment">%   xc: concrete stresses (without smeared reinforcement)</span>
0047 <span class="comment">%   y : collapse mode</span>
0048 <span class="comment">%   lambda: load-factor</span>
0049 <span class="comment">%  prob: struct: problem input matrices</span>
0050 <span class="comment">%   X: node coordinats matrix</span>
0051 <span class="comment">%   T: element topology matrix</span>
0052 <span class="comment">%   G: material parameters struct</span>
0053 <span class="comment">%   S: supports matrix</span>
0054 <span class="comment">%   L: load matrix</span>
0055 <span class="comment">%</span>
0056 <span class="comment">% Latest author:</span>
0057 <span class="comment">% 30-07-2019 Mads Emil Møller Andersen - MEMAndersen@gmail.com</span>
0058 
0059 <span class="comment">% Start timer</span>
0060 tic
0061 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Starting main program\n'</span>)
0062 
0063 <span class="comment">%% Input parser</span>
0064 
0065 <span class="comment">% parse input</span>
0066 input = inputParser;
0067 input.FunctionName = <span class="string">'fela_main'</span>;
0068 
0069 addRequired(input, <span class="string">'msh_path'</span>, @isfile)
0070 addRequired(input, <span class="string">'materials'</span>, @isstruct)
0071 addRequired(input, <span class="string">'supports'</span>, @isstruct)
0072 addRequired(input, <span class="string">'loads'</span>, @isstruct)
0073 addOptional(input, <span class="string">'options'</span>, <a href="fela_options.html" class="code" title="function options = fela_options()">fela_options</a>(), @isstruct)
0074 
0075 parse(input, msh_path, materials, supports, loads, varargin{:})
0076 
0077 
0078 <span class="comment">%% Handle input</span>
0079 
0080 <span class="comment">% Load .msh file and fix</span>
0081 mesh = <a href="../../mema_fela/gen_functions/load_msh.html" class="code" title="function mesh = load_msh(filename)">load_msh</a>(input.Results.msh_path);
0082 mesh = <a href="../../mema_fela/gen_functions/fix_mesh.html" class="code" title="function mesh = fix_mesh(mesh)">fix_mesh</a>(mesh);
0083 
0084 <span class="comment">% Unpack mesh and initlize prob struct</span>
0085 prob.T = mesh.domain.elements;
0086 prob.X = mesh.nodes;
0087 
0088 <span class="comment">% Get nel and nno</span>
0089 nel = size(prob.T,1); mesh.nel = nel; prob.nel = nel;
0090 nno = size(prob.X,1); mesh.nno = nno; prob.nno = nno;
0091 
0092 <span class="comment">% MATERIALs:</span>
0093 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Creating material data array. Time %2.2f '</span>,toc)
0094 prob.G = <a href="fela_material.html" class="code" title="function G = fela_material(mesh, materials)">fela_material</a>(mesh, input.Results.materials);
0095 
0096 <span class="comment">% SUPPORTS:</span>
0097 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Creating support data array. Time %2.2f '</span>,toc)
0098 prob.S = <a href="fela_support.html" class="code" title="function S = fela_support(mesh, supports)">fela_support</a>(mesh, input.Results.supports);
0099 
0100 <span class="comment">% LOADS:</span>
0101 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Creating loads data array. Time %2.2f '</span>,toc)
0102 prob.L = <a href="fela_load.html" class="code" title="function L = fela_load(mesh, X, loads)">fela_load</a>(mesh, prob.X, input.Results.loads);
0103 
0104 <span class="comment">%% Create system matrices</span>
0105 
0106 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Determining equation structure. Time %2.2f '</span>,toc)
0107 [nno,nel,nvar,neq,varperel,eqperel,~]=<a href="../../mema_fela/cmm3/setvareq_cmm3.html" class="code" title="function [nno,nel,nvar,neq,varperel,eqperel,legno]=setvareq_cmm3(X,T)">setvareq_cmm3</a>(prob.X,prob.T);
0108 
0109 <span class="comment">% establish equilibrium matrix</span>
0110 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Establishing equilibrium matrix. Time %2.2f '</span>,toc)
0111 H=<a href="../../mema_fela/cmm3/seth_cmm3.html" class="code" title="function H=seth_cmm3(X,T,nel,neq,nvar,eqperel,varperel)">seth_cmm3</a>(prob.X,prob.T,nel,neq,nvar,eqperel,varperel);
0112 
0113 <span class="comment">% set supports</span>
0114 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Setting supports. Time %2.2f '</span>,toc)
0115 [prob.supeq,H]=<a href="../../mema_fela/cmm3/setsup_cmm3.html" class="code" title="function [supeq, H]=setsup_cmm3(S,H)">setsup_cmm3</a>(prob.S,H);
0116 
0117 <span class="comment">% set loads</span>
0118 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Setting loads. Time %2.2f '</span>,toc)
0119 [~,Rsup]=<a href="../../mema_fela/cmm3/setload_cmm3.html" class="code" title="function [R, Rsup]=setload_cmm3(neq,supeq,L)">setload_cmm3</a>(neq,prob.supeq,prob.L);
0120 
0121 <span class="comment">% set constraints</span>
0122 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Setting constraints. Time %2.2f '</span>,toc)
0123 [Ab,blc,buc,bs,bt,subi] = <a href="../../mema_fela/cmm3/setcon_cmm3.html" class="code" title="function [Ab,blc,buc,bs,bt,subi] = setcon_cmm3(nel,G,varargin)">setcon_cmm3</a>(nel,prob.G,<span class="string">'stressFac'</span>,1);
0124 
0125 <span class="comment">%% Optimize</span>
0126 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Optimizing. Time %2.2f '</span>,toc)
0127 [sol]=<a href="../../mema_fela/cmm3/solveopt_cmm3.html" class="code" title="function [sol]=solveopt_cmm3(nel,Hsup,Rsup,Ab,blc,buc,bs,bt,subi,G,options)">solveopt_cmm3</a>(nel,H,Rsup,Ab,blc,buc,bs,bt,subi,prob.G,input.Results.options);
0128 
0129 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'Program over. Time %2.2f'</span>,toc)
0130 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'lambda = %.2f'</span>, sol.lambda)
0131 <a href="../../mema_fela/gen_functions/write_log.html" class="code" title="function write_log(data,varargin)">write_log</a>(<span class="string">'close'</span>)
0132 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 31-Jul-2019 14:03:20 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>