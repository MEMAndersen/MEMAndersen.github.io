<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of vtkwrite_tet</title>
  <meta name="keywords" content="vtkwrite_tet">
  <meta name="description" content="vtkwrite_tet: Writes a .VTK file to visualize results in paraview.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # mema_fela --><!-- menu.html io -->
<h1>vtkwrite_tet
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>vtkwrite_tet: Writes a .VTK file to visualize results in paraview.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function vtkwrite_tet(vtk_path,prob,sol) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> vtkwrite_tet: Writes a .VTK file to visualize results in paraview.
  FORMAT: vtkwrite_tet(vtk_path,prob,sol)
 Input:
  vtk_path: string: path of the .vtk file to be written

  prob: struct: Contains information about the problem, mesh etc. see
  fela_main for full description


  sol: struct: contains the solution to the problem see fela_main for full
  description 

 16-02-2018 Mads Emil Møller Andersen &amp; Nikolaj Skafte Koch
 Code modified from Chaoyuan Yeh, William Thielicke and David Gingras's

 Latest author:
 30-07-2019 Mads Emil Møller Andersen - MEMAndersen@gmail.com</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../mema_fela/fela/fela_post.html" class="code" title="function fela_post(sol, prob, varargin)">fela_post</a>	fela_post: Post processing of solution, matlat plots or vtk files are</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function vtkwrite_tet(vtk_path,prob,sol)</a>
0002 <span class="comment">% vtkwrite_tet: Writes a .VTK file to visualize results in paraview.</span>
0003 <span class="comment">%  FORMAT: vtkwrite_tet(vtk_path,prob,sol)</span>
0004 <span class="comment">% Input:</span>
0005 <span class="comment">%  vtk_path: string: path of the .vtk file to be written</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%  prob: struct: Contains information about the problem, mesh etc. see</span>
0008 <span class="comment">%  fela_main for full description</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%  sol: struct: contains the solution to the problem see fela_main for full</span>
0012 <span class="comment">%  description</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% 16-02-2018 Mads Emil Møller Andersen &amp; Nikolaj Skafte Koch</span>
0015 <span class="comment">% Code modified from Chaoyuan Yeh, William Thielicke and David Gingras's</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Latest author:</span>
0018 <span class="comment">% 30-07-2019 Mads Emil Møller Andersen - MEMAndersen@gmail.com</span>
0019 
0020 
0021 <span class="comment">% Determine materials</span>
0022 <span class="comment">% Count members of each material</span>
0023 ind.RC = ismember(cellstr(prob.G.type),<span class="string">'RC'</span>);
0024 ind.S = ismember(cellstr(prob.G.type),<span class="string">'S'</span>);
0025 n.RC = sum(ind.RC);
0026 n.S = sum(ind.S);
0027 
0028 <span class="keyword">if</span> strcmpi(vtk_path,<span class="string">'execute'</span>), vtk_path = <span class="string">'matlab_export.vtk'</span>; <span class="keyword">end</span>
0029 fid = fopen(vtk_path, <span class="string">'w'</span>);
0030 <span class="comment">% VTK files contain five major parts</span>
0031 <span class="comment">% 1. VTK DataFile Version</span>
0032 fprintf(fid, <span class="string">'# vtk DataFile Version 4.2\r\n'</span>);
0033 <span class="comment">% 2. Title</span>
0034 fprintf(fid, <span class="string">'VTK from Matlab\r\n'</span>);
0035 
0036 <span class="comment">% 3. The format data proper is saved in (ASCII or Binary). Use</span>
0037 <span class="comment">% fprintf to write data in the case of ASCII and fwrite for binary.</span>
0038 fprintf(fid, <span class="string">'ASCII\r\n'</span>);
0039 
0040 x = prob.X(:,1);
0041 y = prob.X(:,2);
0042 z = prob.X(:,3);
0043 <span class="keyword">if</span> sum(size(x)==size(y) &amp; size(y)==size(z))~=length(size(x))
0044     error(<span class="string">'Input dimesions do not match'</span>)
0045 <span class="keyword">end</span>
0046 <span class="comment">% 4. Type of Dataset UNSTRUCTURED_GRID</span>
0047 <span class="comment">% This part, dataset structure, begins with a line containing the</span>
0048 <span class="comment">% keyword 'DATASET' followed by a keyword describing the type of dataset.</span>
0049 <span class="comment">% Then the geomettry part describes geometry and topology of the dataset.</span>
0050 
0051 fprintf(fid, <span class="string">'DATASET UNSTRUCTURED_GRID\r\n'</span>);
0052 
0053 <span class="comment">% 5.This final part describe the dataset attributes and begins with the</span>
0054 <span class="comment">% keywords 'POINT_DATA' or 'CELL_DATA', followed by an integer number</span>
0055 <span class="comment">% specifying the number of points of cells. Other keyword/data combination</span>
0056 <span class="comment">% then define the actual dataset attribute values.</span>
0057 
0058 <span class="comment">% Precision of saved floats</span>
0059 precision = <span class="string">'4'</span>;
0060 
0061 n_nodes = numel(x);
0062 n_elements = size(prob.T,1);
0063 size_elements = numel(prob.T)+n_elements;
0064 <span class="comment">% WRITE POINTS/NODES</span>
0065 fprintf(fid, [<span class="string">'POINTS '</span> num2str(n_nodes) <span class="string">' float\r\n'</span>]);
0066 spec = [repmat([<span class="string">'%0.'</span>, precision, <span class="string">'f '</span>], 1, 3), <span class="string">'\r\n'</span>];
0067 fprintf(fid, spec, prob.X');
0068 
0069 <span class="comment">% WRITE CELLS</span>
0070 fprintf(fid, [<span class="string">'\r\nCELLS '</span> num2str(n_elements) <span class="string">' '</span> num2str(size_elements) <span class="string">'\r\n'</span>]);
0071 fprintf(fid,<span class="string">'4 %d %d %d %d\r\n'</span>,prob.T'-1); <span class="comment">%-1 because arrays start at 0 in vtk</span>
0072 
0073 <span class="comment">% WRITE CELL TYPES (tetrahedron = 10)</span>
0074 fprintf(fid, [<span class="string">'\r\nCELL_TYPES '</span> num2str(n_elements) <span class="string">'\r\n'</span>]);
0075 fprintf(fid,<span class="string">'%d\r\n'</span>,10*ones(1,n_elements));
0076 
0077 <span class="comment">% WRITE FIELD DATA</span>
0078 <span class="comment">% CELL VALUES</span>
0079 fprintf(fid, [<span class="string">'\r\nCELL_DATA '</span> num2str(n_elements) <span class="string">'\r\n'</span>]);
0080 
0081 <span class="comment">% cell number</span>
0082 fprintf(fid, [<span class="string">'SCALARS el float 1\r\n'</span>]);
0083 fprintf(fid,<span class="string">'LOOKUP_TABLE default\r\n'</span>);
0084 fprintf(fid,<span class="string">'%d\r\n'</span>,1:n_elements);
0085 fprintf(fid,<span class="string">'\r\n'</span>);
0086 
0087 <span class="comment">% Material types</span>
0088 mat = ones(1,n_elements);
0089 mat(1,ind.S) = mat(1,ind.S) + 1;
0090 fprintf(fid, [<span class="string">'SCALARS typ float 1\r\n'</span>]);
0091 fprintf(fid,<span class="string">'LOOKUP_TABLE default\r\n'</span>);
0092 fprintf(fid,<span class="string">'%d\r\n'</span>,mat);
0093 fprintf(fid,<span class="string">'\r\n'</span>);
0094 
0095 <span class="comment">% Stresses</span>
0096 spec = [repmat([<span class="string">'%0.'</span>, precision, <span class="string">'f '</span>], 1, 3), <span class="string">'\r\n'</span>];
0097 xc = sol.xc;
0098 fprintf(fid, [<span class="string">'TENSORS xc float \r\n'</span>]);
0099 <span class="keyword">for</span> el = 1:n_elements
0100     sigvec = xc(1+(el-1)*6:6+(el-1)*6);
0101     sig = [sigvec(1) sigvec(4) sigvec(5)
0102         sigvec(4) sigvec(2) sigvec(6)
0103         sigvec(5) sigvec(6) sigvec(3)];
0104     fprintf(fid,spec,sig);
0105     fprintf(fid,<span class="string">'\r\n'</span>);
0106 <span class="keyword">end</span>
0107 
0108 fprintf(fid, [<span class="string">'TENSORS xt float \r\n'</span>]);
0109 xt = sol.xt;
0110 <span class="keyword">for</span> el = 1:n_elements
0111     sigvec = xt(1+(el-1)*6:6+(el-1)*6);
0112     sig = [sigvec(1) sigvec(4) sigvec(5)
0113         sigvec(4) sigvec(2) sigvec(6)
0114         sigvec(5) sigvec(6) sigvec(3)];
0115     fprintf(fid,spec,sig);
0116     fprintf(fid,<span class="string">'\r\n'</span>);
0117 <span class="keyword">end</span>
0118 
0119 fprintf(fid, [<span class="string">'TENSORS xs float \r\n'</span>]);
0120 xs = sol.xs;
0121 <span class="keyword">for</span> el = 1:n_elements
0122     sigvec = xs(1+(el-1)*6:6+(el-1)*6);
0123     sig = [sigvec(1) sigvec(4) sigvec(5)
0124         sigvec(4) sigvec(2) sigvec(6)
0125         sigvec(5) sigvec(6) sigvec(3)];
0126     fprintf(fid,spec,sig);
0127     fprintf(fid,<span class="string">'\r\n'</span>);
0128 <span class="keyword">end</span>
0129 
0130 <span class="comment">% principal stress normals</span>
0131 sigma1 = zeros(n_elements,1);
0132 sigma2 = zeros(n_elements,1);
0133 sigma3 = zeros(n_elements,1);
0134 n1 = zeros(n_elements,3);
0135 n2 = zeros(n_elements,3);
0136 n3 = zeros(n_elements,3);
0137 
0138 <span class="keyword">for</span> el = 1:n_elements
0139     sigvec = xt(1+(el-1)*6:6+(el-1)*6);
0140     sig = [sigvec(1) sigvec(4) sigvec(5)
0141         sigvec(4) sigvec(2) sigvec(6)
0142         sigvec(5) sigvec(6) sigvec(3)];
0143     
0144     [vec,val] = eig(sig);
0145     [omega,ind] = sort(diag(val));
0146     sigma3(el) = omega(1);
0147     sigma2(el) = omega(2);
0148     sigma1(el) = omega(3);
0149     n3(el,:) = vec(:,ind(1));
0150     n2(el,:) = vec(:,ind(2));
0151     n1(el,:) = vec(:,ind(3));
0152 <span class="keyword">end</span>
0153 
0154 fprintf(fid, [<span class="string">'VECTORS n1 float\r\n'</span>]);
0155 fprintf(fid,spec,n1');
0156 fprintf(fid,<span class="string">'\r\n'</span>);
0157 fprintf(fid, [<span class="string">'VECTORS n2 float \r\n'</span>]);
0158 fprintf(fid,spec,n2');
0159 fprintf(fid,<span class="string">'\r\n'</span>);
0160 fprintf(fid, [<span class="string">'VECTORS n3 float \r\n'</span>]);
0161 fprintf(fid,spec,n3');
0162 fprintf(fid,<span class="string">'\r\n'</span>);
0163 
0164 fprintf(fid, [<span class="string">'SCALARS sigma1 float 1\r\n'</span>]);
0165 spec = [repmat([<span class="string">'%0.'</span>, precision, <span class="string">'f '</span>], 1, 1), <span class="string">'\r\n'</span>];
0166 fprintf(fid,<span class="string">'LOOKUP_TABLE default\r\n'</span>);
0167 fprintf(fid,spec,sigma1);
0168 fprintf(fid,<span class="string">'\r\n'</span>);
0169 fprintf(fid, [<span class="string">'SCALARS sigma2 float 1\r\n'</span>]);
0170 fprintf(fid,<span class="string">'LOOKUP_TABLE default\r\n'</span>);
0171 fprintf(fid,spec,sigma2);
0172 fprintf(fid,<span class="string">'\r\n'</span>);
0173 fprintf(fid, [<span class="string">'SCALARS sigma3 float 1\r\n'</span>]);
0174 fprintf(fid,<span class="string">'LOOKUP_TABLE default\r\n'</span>);
0175 fprintf(fid,spec,sigma3);
0176 fprintf(fid,<span class="string">'\r\n'</span>);
0177 
0178 <span class="comment">%Collapse mode</span>
0179 fprintf(fid, [<span class="string">'POINT_DATA '</span> num2str(n_nodes) <span class="string">'\r\n'</span>]);
0180 
0181 <span class="comment">% node numbers</span>
0182 fprintf(fid, [<span class="string">'SCALARS no float 1\r\n'</span>]);
0183 fprintf(fid,<span class="string">'LOOKUP_TABLE default\r\n'</span>);
0184 fprintf(fid,<span class="string">'%d\r\n'</span>,1:n_nodes);
0185 fprintf(fid,<span class="string">'\r\n'</span>);
0186 
0187 <span class="comment">% collapse mode</span>
0188 spec = [repmat([<span class="string">'%0.'</span>, precision, <span class="string">'f '</span>], 1, 3), <span class="string">'\r\n'</span>];
0189 alldof = 1:n_nodes*3;
0190 freedof = setdiff(alldof,prob.supeq);
0191 y = zeros(n_nodes*3,1);
0192 y(freedof) = sol.y;
0193 y = y./max(abs(y)); <span class="comment">%Scale to 1</span>
0194 fprintf(fid, [<span class="string">'VECTORS u float \r\n'</span>]);
0195 fprintf(fid,spec,y);
0196 
0197 <span class="comment">%%</span>
0198 
0199 <span class="keyword">if</span> strcmpi(vtk_path,<span class="string">'matlab_export.vtk'</span>)
0200     <span class="keyword">switch</span> computer
0201         <span class="keyword">case</span> {<span class="string">'PCWIN'</span>,<span class="string">'PCWIN64'</span>}
0202             !paraview.exe --data=<span class="string">'matlab_export.vtk'</span> &amp;
0203             <span class="comment">% Exclamation point character is a shell escape, the rest of the</span>
0204             <span class="comment">% input line will be sent to operating system. It can not take</span>
0205             <span class="comment">% variables, though. The &amp; at the end of line will return control to</span>
0206             <span class="comment">% Matlab even when the outside process is still running.</span>
0207         <span class="keyword">case</span> {<span class="string">'GLNXA64'</span>,<span class="string">'MACI64'</span>}
0208             !paraview --data=<span class="string">'matlab_export.vtk'</span> &amp;
0209     <span class="keyword">end</span>
0210 <span class="keyword">end</span>
0211 fclose(fid);
0212 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 31-Jul-2019 14:03:20 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>